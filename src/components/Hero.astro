---
import type { HeroProps } from "@src-types/types.ts";
import ArchiveTags from "@components/ArchiveTags.astro";

import "@styles/hero.css";

const {
  title,
  description,
  is_homepage,
  is_archivepage = false,
  total_number
} = Astro.props as HeroProps;

const { globalSettings, t } = Astro.props;
---

<section class="hero-final-layout">
  <div class="hero-container-stable">
    
    <div class="hero-main-content">
      {/* --- 左側文字區域 --- */}
      <div class="text-side">
        <div class="title-container">
          <span class="green-dot breathing"></span>
          
          <h1 class="hero-title-fixed">
            <span class="en-part">
              <span class="float-up" style="animation-delay: 0.1s;">E</span>
              <span class="float-up" style="animation-delay: 0.2s;">N</span>
            </span>
            <span class="route-part">
              <span class="float-up" style="animation-delay: 0.3s;">R</span>
              <span class="float-up" style="animation-delay: 0.4s;">O</span>
              <span class="float-up" style="animation-delay: 0.5s;">U</span>
              <span class="float-up" style="animation-delay: 0.6s;">T</span>
              <span class="float-up" style="animation-delay: 0.7s;">E</span>
            </span>
          </h1>
        </div>
        
        {!is_homepage && total_number && (
          <h3 class="total-number-text float-up" style="animation-delay: 0.9s;">{total_number}</h3>
        )}
      </div>

      {/* --- 右側圖片區域 --- */}
      <div class="image-side">
        <div class="image-box float-up-fade" style="animation-delay: 0.4s;">
          <img
            src="/my-hero.jpeg"
            alt="Hero Image"
            class="hero-img-contain mirror-x"
          />
        </div>
      </div>
    </div>

    <div class="hero-full-width-line"></div>

  </div>
</section>

<style>
  /* 1. Logo 縮放控制 (僅在 Desktop 生效) */
  @media (min-width: 769px) {
    :global(.navbar-logo), :global(.site-logo), :global(.logo) {
        transform: scale(2) !important;
        transform-origin: left center !important;
    }
  }

  /* 2. 基礎容器 (PC 原始提拉 -8vh 保持不變) */
  .hero-final-layout {
      width: 100%;
      height: auto; 
      min-height: 70vh; 
      background-color: black;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      overflow: hidden;
      margin-top: -8vh;
  }

  .hero-container-stable {
      width: 92%;
      max-width: 1700px;
      display: flex;
      flex-direction: column;
      position: relative;
  }

  /* 3. 主要排版 (PC 原始佈局保持不變) */
  .hero-main-content {
      display: flex;
      flex-direction: row;
      align-items: flex-end;
      justify-content: space-between;
      gap: 3vw; 
      width: 100%;
  }

  /* 4. 文字與綠點 (180px / 0.7em 原始數值不變) */
  .text-side {
      flex: 1 1 auto;
      position: relative;
  }
  .title-container { position: relative; display: inline-block; }
  .green-dot {
      position: absolute; width: 32px; height: 32px;
      background-color: #39FF14; border-radius: 50%;
      z-index: 10; top: 5%; left: -50px; 
      box-shadow: 0 0 20px rgba(57, 255, 20, 0.8);
  }
  .breathing { animation: breathe 3s ease-in-out infinite; }
  @keyframes breathe {
      0%, 100% { transform: scale(1); opacity: 1; }
      50% { transform: scale(1.15); opacity: 0.7; }
  }

  .hero-title-fixed {
      display: flex; flex-direction: column; line-height: 0.95; 
      margin: 0; font-weight: 900; color: white; font-size: 180px; 
  }
  .en-part { display: flex; font-size: 0.7em !important; letter-spacing: -0.06em; }
  .route-part { display: flex; font-size: 1em; letter-spacing: -0.04em; }

  /* 進場動畫 (PC/Mobile 通用穩定邏輯) */
  .float-up {
      display: inline-block; opacity: 0; transform: translateY(30px);
      animation: charFloatUp 0.8s cubic-bezier(0.22, 1, 0.36, 1) forwards;
  }
  @keyframes charFloatUp { to { opacity: 1; transform: translateY(0); } }

  .float-up-fade {
      opacity: 0;
      transform: translateY(40px);
      animation: imgFloatUp 1.2s cubic-bezier(0.22, 1, 0.36, 1) forwards;
  }
  @keyframes imgFloatUp { to { opacity: 1; transform: translateY(0); } }

  /* 5. 圖片區域動畫 */
  .image-side {
      flex: 0 0 55%;
      display: flex;
      align-items: flex-end;
  }
  .image-box {
      width: 100%;
      max-width: 1000px;
      overflow: hidden; 
      border-radius: 4px;
      background-color: transparent; /* 防止變黑 */
  }
  .hero-img-contain {
      width: 100%;
      height: auto;
      object-fit: contain;
      display: block;
      transition: transform 0.6s cubic-bezier(0.22, 1, 0.36, 1);
      /* 關鍵：防止手機觸控閃爍變色 */
      -webkit-tap-highlight-color: transparent;
      -webkit-backface-visibility: hidden;
      backface-visibility: hidden;
  }
  .mirror-x { transform: scaleX(-1); }

  /* 只在支援 Hover 的裝置（PC）執行放大，避免手機變黑 */
  @media (hover: hover) {
    .image-box:hover .hero-img-contain.mirror-x {
        transform: scaleX(-1) scale(1.1);
    }
  }

  /* 6. 線條 (50px 原始間距不變) */
  .hero-full-width-line {
      width: 100%; height: 2px;
      background-color: rgba(255, 255, 255, 0.5); margin-top: 50px;
  }

  :global(section:not(.hero-final-layout):first-of-type) {
      margin-top: -60px !important; position: relative; z-index: 5;
  }

  /* 電腦大螢幕優化 (220px 原始數值) */
  @media (min-width: 1600px) {
      .hero-title-fixed { font-size: 220px; }
      .green-dot { width: 40px; height: 40px; left: -65px; }
  }

  /* 手機版適配 (修復對齊與穩定性) */
  @media (max-width: 768px) {
      :global(.navbar-logo), :global(.site-logo), :global(.logo) {
          transform: scale(1) !important;
      }

      .hero-final-layout {
          margin-top: 0; 
          align-items: flex-start; /* 整體改為靠左對齊 */
      }

      .hero-container-stable {
          width: 90%; /* 稍微縮小寬度，避免貼邊 */
          margin-left: 5%;
      }

      .hero-main-content {
          flex-direction: column;
          align-items: flex-start; /* 內容改為靠左對齊 */
          text-align: left;
          gap: 30px;
      }

      .hero-title-fixed {
          font-size: 22vw; 
          text-align: left;
      }
      
      .en-part, .route-part { 
          justify-content: flex-start; /* 文字強制靠左 */
      }

      .image-side { 
          width: 100%; 
          justify-content: flex-start; /* 圖片強制靠左 */
      }
      
      .image-box { 
          max-width: 100%; 
          overflow: visible; 
      }

      .green-dot { display: none; }
  }
</style>
---
// src/pages/topics/[topic].astro
import BaseLayout from "../../layouts/BaseLayout.astro";
import PostCard from "../../components/PostCard.astro";
import { getPostsByTag, getTags } from "../../utils/utils.js";
import globalSettings from "../../config/config.json.ts";

export async function getStaticPaths() {
  const tags = await getTags(); 
  return tags.map((tag: any) => ({
    params: { topic: tag.slug },
    props: { tag_name: tag.original },
  }));
}

const { tag_name } = Astro.props;
const { posts } = await getPostsByTag({ tag: tag_name });

const t = {
  global: {
    navbar: { home: "Home", topics: "Topics", archive: "Archive", about: "About", site: "Site", sign_in: "Sign in" },
    footer: { footer_text: globalSettings.site_description, form_placeholder: "EMAIL", credits: "All rights reserved." }
  }
};
---

<BaseLayout title={tag_name} globalSettings={globalSettings} t={t}>
  <section style="max-width:1200px;margin:0 auto;padding:80px 20px;">
    <h1 style="font-size:3.5rem;font-weight:800;border-bottom:1px solid var(--text-color-20);padding-bottom:20px;margin-bottom:60px;">{tag_name}</h1>
    <div style="display:grid;grid-template-columns:repeat(auto-fill,minmax(350px,1fr));gap:40px;">
      {posts.map((post: any) => <PostCard post={post} />)}
    </div>
  </section>
</BaseLayout>